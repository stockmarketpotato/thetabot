<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<div th:replace="~{fragments/headerfiles :: header}"></div>
<title>ThetaBot - Feed Management</title>
</head>
<body>
  <div th:replace="~{fragments/header :: header}"></div>
  <main role="main" class="container">
    <h1>Feed Management</h1>
    <p>Provides access to real-time or historic quotes. Offers notification for updates of quotes.</p>
    
    <p>Manually Add Quote Alert</p>
    <form th:action="@{/feeds/addalertmanual}">
      <input type="text" th:name="account" placeholder="account" />
      <input type="text" th:name="symbol" placeholder="symbol" />
      <input type="text" th:name="streamerSymbol" placeholder="streamerSymbol" />
      <input type="number" step="0.01" th:name="triggerPrice" placeholder="triggerPrice" />
      <input type="text" th:name="orderId" placeholder="orderId" />
      <input type="submit"/> 
    </form>
    <p>Send Test Quote</p>
    <form th:action="@{/feeds/sendquote}">
      <input type="text" th:name="symbol" placeholder="symbol" />
      <input type="text" th:name="streamerSymbol" placeholder="streamerSymbol" />
      <input type="number" step="0.01" th:name="bidPrice" placeholder="bidPrice" />
      <input type="number" step="0.01" th:name="askPice" placeholder="askPice" />
      <input type="submit"/> 
    </form>
    
    <button type="button" th:onclick="|window.location.href='/feeds/reconnect'|">Reconnect</button>
    <div class="row justify-content-center">
      <div class="col-xl-12">
        <table class="table">
          <tr th:each="s : ${webSocketState}">
            <td>
              <p th:text="${s.key}"></p>
            </td>
            <td>
              <p th:text="${s.value}"></p>
            </td>
          </tr>
        </table>
        <h3>Stop Loss</h3>
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Symbol</th>
              <th scope="col">Trigger Price</th>
              <th scope="col">Order ID</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="item : ${alerts}">
              <td>
                <p th:text="${item.symbol}"></p>
              </td>
              <td>
                <p th:text="${#numbers.formatDecimal(item.getTriggerPrice(), 1, 'COMMA', 2, 'POINT')}"></p>
              </td>
              <td>
                <p th:text="${item.getOrderId()}"></p>
              </td>
                <td>
                  <a class="btn btn-light btn-sm"
                    th:href="@{'/feeds/deleteAlert?id=' + ${item.id}}"
                    onclick="return confirm('Are you sure you want to delete this alert?')"><i class="bi bi-trash3"></i></a>
                </td>
            </tr>
          </tbody>
        </table>
        <h3>Subscriptions</h3>
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Subscription</th>
              <th scope="col">Delta</th>
              <th scope="col">Latest Ask</th>
              <th scope="col">Ask Time</th>
              <th scope="col">Latest Bid</th>
              <th scope="col">Bid Time</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="item : ${subscriptions}">
              <td>
                <p th:text="${item.key}"></p>
              </td>
              <td>
                <p th:if="${item.value}" th:text="${item.value.getDeltaAsString()}"></p>
              </td>
              <td>
                <p th:if="${item.value}" th:text="${item.value.getAskPriceAsString()}"></p>
              </td>
              <td>
                <p th:text="${#dates.format(item.value.getAskTime(), 'HH:mm - dd. MMM yyyy')}"></p>
              </td>
              <td>
                <p th:if="${item.value}" th:text="${item.value.getBidPriceAsString()}"></p>
              </td>
              <td>
                <p th:text="${#dates.format(item.value.getBidTime(), 'HH:mm - dd. MMM yyyy')}"></p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>
  <div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>