<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <div th:replace="~{fragments/headerfiles :: header}"></div>
  <title>ThetaBot Main Page</title>
  <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" src="https://cdn.canvasjs.com/canvasjs.stock.min.js"></script>
  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <script src="https://code.highcharts.com/stock/modules/price-indicator.js"></script>
  <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/stock/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/stock/modules/accessibility.js"></script>
  <style>
  .btn-primary, .btn-primary:hover, .btn-primary:active, .btn-primary:visited { background-color: #755f91 !important;  border-color: #755f91 !important; }
  </style>
</head>

<body>
  <div th:replace="~{fragments/header :: header}"></div>
  <main role="main" class="container">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-sm">
          <h3>Dashboard</h3>
          <p>ThetaEngineBot is a simple Short Put Options trading bot.</p>
        </div>
      </div>
      
      <div th:replace="~{fragments/highchart :: usd}"></div>
      <div th:replace="~{fragments/highchart :: eur}"></div>

      <div class="row justify-content-center">
        <div class="col-sm">
          <div class="card-deck mb-3 text-center">
            <div class="card mb-4 box-shadow rounded" th:if="${bot != null}">
              <div class="card-header">
                <h4 class="my-0 font-weight-normal"></h4>
                <h4 class="my-0 font-weight-normal" th:text="'&#129302;' + ${bot.name}"></h4>
              </div>
              <div class="card-body">
                <div class="m-4">
                  <div class="col" th:if="not ${scheduledTasks.isEmpty()}">
                    <table class="table table-hover table-responsive table-sm">
                      <thead>
                        <tr>
                          <th scope="col">
                            <p>
                              <i class="bi bi-calendar-event"></i>
                            </p>
                          </th>
                          <th scope="col">
                            <p>Market Time</p>
                          </th>
                          <th scope="col">
                            <p>Local Time</p>
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr th:each="task : ${scheduledTasks}">
                          <td>
                            <p th:text="${task.key}">key</p>
                          </td>
                          <td>
                            <p th:text="${#temporals.format(task.value.market, 'HH:mm')}"></p>
                          </td>
                          <td>
                            <p th:text="${#temporals.format(task.value.local, 'HH:mm')}"></p>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="m-4">
                  <a class="btn btn-primary p-0" href="#" th:href="@{'/bots/editBot?id=' + ${bot.id}}" style="width: 230px; ">
                    <div class="container-fluid p-0 pb-1">
                      <div class="row g-0">
                        <div class="col d-flex flex-column">
                          <span style="font-size: 12px; font-weight: bold;">Parameters</span>
                        </div>
                      </div>
                      <div class="row g-0">
                        <div class="col-4 d-flex flex-column justify-content-center align-items-center">
                          <span style="font-size: 10px" th:text="${#numbers.formatDecimal(bot.takeProfit * 100.0, 1, 'COMMA', 0, 'POINT')} + '% '">Take
                            Profit</span> <span style="font-size: 8px"><i class="bi bi-cash"></i> Take Profit</span>
                        </div>
                        <div class="col-4 d-flex flex-column justify-content-center align-items-center">
                          <span style="font-size: 10px" th:text="${#numbers.formatDecimal(bot.stopLoss * 100.0, 1, 'COMMA', 0, 'POINT')} + '% '">Stop
                            Loss</span> <span style="font-size: 8px"><i class="bi bi-sign-stop"></i> Stop Loss</span>
                        </div>
                        <div class="col-4 d-flex flex-column justify-content-center align-items-center">
                          <span style="font-size: 10px" th:text="${bot.getUnderlying().getDisplayValue()}">Underlying</span>
                          <span style="font-size: 8px">Underlying</span>
                        </div>
                      </div>
                    </div>
                  </a>
                </div>
                <div class="m-4">
                  <a class="btn btn-primary p-0" href="#" th:href="@{/tradelog}" style="width: 230px;">
                    <div class="container-fluid p-0 pb-1">
                      <div class="row g-0">
                        <div class="col d-flex flex-column">
                          <span style="font-size: 12px; font-weight: bold;">Performance</span>
                        </div>
                      </div>
                      <div class="row g-0">
                        <div class="col-4 d-flex flex-column justify-content-center align-items-center">
                          <span style="font-size: 10px" th:text="'$' + ${performance.getTotalpnl()}">totalpnl</span> <span style="font-size: 8px">Total P/L</span>
                        </div>
                        <div class="col-4 d-flex flex-column justify-content-center align-items-center">
                          <span style="font-size: 10px" th:text="${#numbers.formatDecimal(metrics.getWinrate() * 100.0, 1, 'COMMA', 0, 'POINT')} + '% '">PCR</span>
                          <span style="font-size: 8px">Win Rate</span>
                        </div>
                        <div class="col-4 d-flex flex-column justify-content-center align-items-center">
                          <span style="font-size: 10px" th:text="${#numbers.formatDecimal(performance.getPcr() * 100.0, 1, 'COMMA', 0, 'POINT')} + '% '">PCR</span>
                          <span style="font-size: 8px">Premium Capture</span>
                        </div>
                      </div>
                    </div>
                  </a>
                </div>
                <div class="m-4">
                  <a class="btn btn-primary p-0" href="#" th:href="@{'/bots/chain?id=' + ${bot.id}}" style="width: 230px;">
                    <div class="container-fluid p-0 pb-1 pt-1">
                      <div class="col d-flex flex-column">
                        <span style="font-size: 12px; font-weight: bold;">Option Chain</span>
                      </div>
                    </div>
                  </a>
                </div>
                <div class="m-4">
                  <a class="btn btn-light btn-sm" th:href="@{'/bots/deleteBot?id=' + ${bot.id}}" onclick="return confirm('Are you sure you want to delete this bot?')"><i class="bi bi-trash3"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-sm">
          <div class="card mb-4 box-shadow rounded">
            <div class="card-header">
              <h4 class="my-0 font-weight-normal">Market</h4>
            </div>
            <div class="card-body">
              <div class="m-4">
                <p th:text="${message}"></p>
                <table class="table table-hover table-responsive table-sm" th:if="${marketOpen.length() > 0}">
                  <tr>
                    <td>
                      <p>Status</p>
                    </td>
                    <td>
                      <p th:text="${marketStatus}"></p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p>Market Open</p>
                    </td>
                    <td>
                      <p th:text="${marketOpen}"></p>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <p>Market Close</p>
                    </td>
                    <td>
                      <p th:text="${marketClose}"></p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-sm-4" th:if="${bot == null}">
          <a class="btn btn-warning" href="#" th:href="@{/bots/createBot}">New Configuration</a>
        </div>
      </div>
    </div>
  </main>
  <div th:replace="~{fragments/footer :: footer}"></div>
</body>

</html>